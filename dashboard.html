<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ISU Hub | Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --isu-green: #2d5a27; --isu-gold: #facc15; --sidebar-bg: #1e3d1a; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; background: #f4f7f6; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .nav-item { padding: 15px 25px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.3s; }
        .nav-item:hover, .active { background: var(--isu-green); border-left: 5px solid var(--isu-gold); }
        
        /* MAIN CONTENT */
        .main { flex: 1; overflow-y: auto; padding: 30px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .admin-only { display: none; }
        .user-only { display: none; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .btn-small { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; }
        .btn-del { background: #ff4757; color: white; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header"><h3>ISU EVENT HUB</h3></div>
        <div class="nav-item active" onclick="showSection('dash')"><i class="fas fa-home"></i> Dashboard</div>
        <div class="nav-item" onclick="showSection('calendar')"><i class="fas fa-calendar"></i> Calendar</div>
        <div class="nav-item user-only" onclick="showSection('reg-event')"><i class="fas fa-user-plus"></i> Register Event</div>
        <div class="nav-item admin-only" onclick="showSection('reg-list')"><i class="fas fa-users"></i> Registered Students</div>
        <div class="nav-item" onclick="showSection('voting')"><i class="fas fa-poll"></i> Voting</div>
        <div class="nav-item" onclick="showSection('attendance')"><i class="fas fa-clock"></i> Attendance</div>
        <div class="nav-item" onclick="showSection('lostfound')"><i class="fas fa-search"></i> Lost & Found</div>
        <div class="nav-item" style="margin-top:auto; color: #ff7675;" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</div>
    </div>

    <div class="main">
        <div class="top-bar">
            <h2 id="section-title">Dashboard</h2>
            <div id="profile-area" style="font-weight: bold; color: var(--isu-green);">
                <i class="fas fa-user-circle"></i> <span id="display-name">User Name</span> | <a href="#" onclick="showSection('profile')">Edit Profile</a>
            </div>
        </div>

        <div class="card">
            <div class="admin-only">
                <h4>Create Announcement</h4>
                <textarea id="ann-text" style="width:100%;" placeholder="Write announcement..."></textarea>
                <button class="btn-small" style="background:var(--isu-green); color:white;" onclick="postAnn()">Post</button>
            </div>
            <div id="ann-display">
                <h4 style="color:var(--isu-green)">ðŸ“¢ Latest Announcement:</h4>
                <p id="current-ann">Welcome to ISU Hub!</p>
            </div>
        </div>

        <div id="section-dash" class="section">
            <div class="admin-only grid-stats" style="display:flex; gap:20px;">
                <div class="card" style="flex:1">Total Users: <b id="stat-users">0</b></div>
                <div class="card" style="flex:1">Registered in Events: <b id="stat-events">0</b></div>
            </div>
            <div class="card">
                <h3>Leaderboard (Standings)</h3>
                <div id="admin-pts" class="admin-only">
                    <input type="text" id="dept-name" placeholder="Dept">
                    <input type="number" id="dept-pts" placeholder="Points">
                    <button onclick="addPoints()">Set Points</button>
                </div>
                <table id="leaderboard-table">
                    <tr><th>Department</th><th>Points</th></tr>
                </table>
            </div>
        </div>

        <div id="section-calendar" class="section" style="display:none;">
            <div class="card">
                <div class="admin-only">
                    <h4>Add Event</h4>
                    <input type="date" id="cal-date">
                    <input type="text" id="cal-title" placeholder="Event Name">
                    <button onclick="addEvent()">Add to Calendar</button>
                </div>
                <table id="calendar-table">
                    <tr><th>Date</th><th>Event</th></tr>
                </table>
            </div>
        </div>

        <div id="section-voting" class="section" style="display:none;">
            <div class="card">
                <div class="admin-only">
                    <h4>Set Election</h4>
                    <input type="text" id="cand-name" placeholder="Candidate Name">
                    <select id="cand-pos"><option>President</option><option>Vice President</option></select>
                    <button onclick="addCandidate()">Add Candidate</button>
                </div>
                <div id="voting-list"></div>
                <div class="admin-only">
                    <h4>Audit: Who Voted?</h4>
                    <table id="voter-audit"><tr><th>ID</th><th>Name</th></tr></table>
                </div>
            </div>
        </div>

        <div id="section-attendance" class="section" style="display:none;">
            <div class="card">
                <h3>Attendance Log</h3>
                <button onclick="markAttendance('AM-IN')">AM Time In</button>
                <button onclick="markAttendance('AM-OUT')">AM Time Out</button>
                <table id="att-table">
                    <tr><th>ID</th><th>Time</th><th>Status</th></tr>
                </table>
            </div>
        </div>

    </div>

    <script>
        const user = JSON.parse(localStorage.getItem('currentUser'));
        
        window.onload = function() {
            if(!user) window.location.href = 'index.html';
            document.getElementById('display-name').innerText = user.name;
            
            if(user.role === 'admin') {
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
                loadAdminStats();
            } else {
                document.querySelectorAll('.user-only').forEach(el => el.style.display = 'block');
            }
            loadAnnouncement();
        };

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById('section-' + id).style.display = 'block';
            document.getElementById('section-title').innerText = id.toUpperCase();
        }

        function postAnn() {
            const txt = document.getElementById('ann-text').value;
            localStorage.setItem('announcement', txt);
            loadAnnouncement();
        }

        function loadAnnouncement() {
            document.getElementById('current-ann').innerText = localStorage.getItem('announcement') || "No announcements.";
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        // CRUD Simulators (Gagamit ng LocalStorage para sa demo)
        function markAttendance(status) {
            let logs = JSON.parse(localStorage.getItem('att_logs')) || [];
            logs.push({id: user.id, time: new Date().toLocaleTimeString(), status: status});
            localStorage.setItem('att_logs', JSON.stringify(logs));
            alert("Attendance Marked: " + status);
        }

        function loadAdminStats() {
            let users = JSON.parse(localStorage.getItem('isu_users')) || [];
            document.getElementById('stat-users').innerText = users.length;
        }
    </script>
</body>
</html>
